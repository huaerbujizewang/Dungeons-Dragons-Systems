<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D å†’é™©è€…å•†åº—</title>
    <!-- å¼•å…¥ Supabase çš„å®˜æ–¹å·¥å…·åŒ… -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #2c2f33; /* æ·±è‰²èƒŒæ™¯å¾ˆæœ‰è·‘å›¢æ°›å›´ */
            color: #ffffff;
            margin: 0;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #f1c40f; /* é‡‘è‰²æ ‡é¢˜ */
        }
        .shop-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        .item-card {
            background-color: #23272a;
            border: 1px solid #7289da;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: transform 0.2s;
        }
        .item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .item-img {
            width: 64px;
            height: 64px;
            margin-bottom: 10px;
        }
        .price {
            color: #f1c40f;
            font-weight: bold;
            font-size: 1.2em;
        }
        .stock {
            font-size: 0.9em;
            color: #99aab5;
        }
        button {
            background-color: #7289da;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background-color: #5b6eae;
        }
        button:disabled {
            background-color: #444;
            cursor: not-allowed;
        }
    </style>
</head>
<body>

    <h1>ğŸ° å†’é™©è€…ç‰©èµ„è¡¥ç»™ç«™</h1>
    <p style="text-align: center; color: #aaa;">DMåå°ç›´è¿ | å®æ—¶åº“å­˜</p>
    
    <div id="shop-container" class="shop-container">
        <!-- å•†å“ä¼šåŠ è½½åˆ°è¿™é‡Œ -->
        <p>æ­£åœ¨ä»å¼‚æ¬¡å…ƒå£è¢‹ï¼ˆæ•°æ®åº“ï¼‰è¯»å–å•†å“...</p>
    </div>

    <script>
        // ================= é…ç½®åŒºåŸŸ =================
        // âš ï¸ è¯·æŠŠä¸‹é¢ä¸¤è¡Œæ¢æˆä½ è‡ªå·±çš„ Supabase æ•°æ®ï¼
        const SUPABASE_URL = 'https://vbzfpgucpciqgaakqndz.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZiemZwZ3VjcGNpcWdhYWtxbmR6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc1OTc2MzMsImV4cCI6MjA4MzE3MzYzM30.fBVDirEJ52bvrYJZ5DNv7fVDLNgCwITKwdKqT6YJDYw';
        // ===========================================

        // åˆå§‹åŒ– Supabase å®¢æˆ·ç«¯
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // è·å–å¹¶æ˜¾ç¤ºå•†å“çš„æ ¸å¿ƒå‡½æ•°
        async function fetchItems() {
            const container = document.getElementById('shop-container');

            // 1. å»æ•°æ®åº“æŸ¥è¡¨
            const { data: items, error } = await supabase
                .from('shop_items') // è¡¨å
                .select('*')        // æŸ¥æ‰€æœ‰å­—æ®µ
                .order('id', { ascending: true }); // æŒ‰IDæ’åº

            if (error) {
                console.error('å‡ºé”™äº†:', error);
                container.innerHTML = `<p style="color:red">æ— æ³•è¿æ¥åˆ°å•†åº—åå°: ${error.message}</p>`;
                return;
            }

            // 2. æ¸…ç©ºåŠ è½½æç¤º
            container.innerHTML = '';

            // 3. éå†æ•°æ®ï¼Œç”Ÿæˆ HTML
            items.forEach(item => {
                const card = document.createElement('div');
                card.className = 'item-card';
                
                // ç®€å•çš„åº“å­˜é€»è¾‘åˆ¤æ–­
                const isOutOfStock = item.stock <= 0;
                const buttonHtml = isOutOfStock 
                    ? `<button disabled>ç¼ºè´§</button>` 
                    : `<button onclick="buyItem('${item.name}')">è´­ä¹° (æµ‹è¯•)</button>`;

                card.innerHTML = `
                    <img src="${item.image_url || 'https://via.placeholder.com/64'}" class="item-img" alt="${item.name}">
                    <h3>${item.name}</h3>
                    <p>${item.description}</p>
                    <div class="price">ğŸ’° ${item.price} GP</div>
                    <div class="stock">åº“å­˜: ${item.stock}</div>
                    ${buttonHtml}
                `;
                container.appendChild(card);
            });
        }

        // æµ‹è¯•è´­ä¹°æŒ‰é’®çš„åŠŸèƒ½ï¼ˆæš‚æ—¶åªæ˜¯å¼¹çª—ï¼‰
        function buyItem(itemName) {
            alert(`ä½ å°è¯•è´­ä¹°äº† [${itemName}]ï¼\n\nä¸‹ä¸€æ­¥æˆ‘ä»¬å°†å®ç°ï¼š\n1. ç©å®¶ç™»å½•\n2. ç‚¹å‡»è´­ä¹°åï¼Œæ•°æ®åº“åº“å­˜è‡ªåŠ¨ -1`);
        }

        // é¡µé¢åŠ è½½å®Œæ¯•åï¼Œè‡ªåŠ¨æ‰§è¡Œ
        fetchItems();

    </script>
</body>
</html>
